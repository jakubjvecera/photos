<!DOCTYPE html>
<html lang="cs">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link rel="icon" href="icon.png" type="image/png">
  <title>Jakub Večeřa</title>
  <style>
    /* ... styly beze změn ... */
    body {
      margin: 0;
      background-color: #121212;
      background-image: repeating-linear-gradient(
        45deg,
        #1a1a1a 0px,
        #1a1a1a 1px,
        #121212 1px,
        #121212 12px
      );
      font-family: Courier, sans-serif;
      color: #eee;
      display: flex;
    }

    /* ostatní styly zůstávají nezměněny */
    /* ... */
  </style>
</head>
<body>

  <div id="sidebar">
    <h1>Jakub Večeřa</h1>
    <img src="logo.png" alt="Logo" id="logo" />
    <div class="links">
      <a href="mailto:jakub.j.vecera@gmail.com" data-copy="jakub.j.vecera@gmail.com" onclick="copyAndOpen(event, this)">Email</a>
      <a href="https://instagram.com/jakubjvecera" data-copy="@jakubjvecera" target="_blank" onclick="copyAndOpen(event, this)">Instagram</a>
      <a href="https://zonerama.com/jakubjvecera/" data-copy="jakubjvecera.zonerama.com" target="_blank" onclick="copyAndOpen(event, this)">Zonerama</a>
    </div>
  </div>

  <div id="gallery-container">
    <div id="gallery"></div>
  </div>

  <div id="lightbox" role="dialog" aria-modal="true" tabindex="-1"></div>

  <div id="copy-toast">Zkopírováno do schránky!</div>

  <noscript>
    <div style="padding: 20px; color: white; background-color: #222; text-align: center;">
      ⚠️ Tato stránka vyžaduje JavaScript pro správné zobrazení galerie. Povolte JavaScript ve svém prohlížeči.
    </div>
  </noscript>

  <script src="fotky.js"></script>
  <script>
    function shuffle(array) {
      for (let i = array.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [array[i], array[j]] = [array[j], array[i]];
      }
      return array;
    }

    const gallery = document.getElementById('gallery');
    const lightbox = document.getElementById('lightbox');
    let currentIndex = -1;

    gallery.addEventListener('contextmenu', (e) => {
      if (e.target.tagName === 'IMG') e.preventDefault();
    });

    lightbox.addEventListener('contextmenu', (e) => {
      if (e.target.tagName === 'IMG') e.preventDefault();
    });

    const imageElements = [];

    shuffle(fotky).forEach((src, index) => {
      const img = document.createElement('img');
      img.src = 'fotos/' + src;
      img.alt = src;
      img.loading = "lazy";
      img.draggable = false;
      img.ondragstart = () => false;
      img.addEventListener('click', () => openLightbox(index));
      gallery.appendChild(img);
      imageElements.push(src);
    });

    function openLightbox(index) {
      currentIndex = index;

      // Odstraň starý obsah
      lightbox.innerHTML = '';

      const img = document.createElement('img');
      img.src = `fotos/${imageElements[index]}`;
      img.alt = '';
      img.draggable = false;
      lightbox.appendChild(img);

      lightbox.style.display = 'flex';
      document.body.style.overflow = 'hidden';

      // Focus kvůli klávesové pasti
      lightbox.focus();
    }

    function closeLightbox() {
      lightbox.style.display = 'none';
      lightbox.innerHTML = '';
      document.body.style.overflow = '';
    }

    function navigateLightbox(direction) {
      if (currentIndex === -1) return;
      currentIndex = (currentIndex + direction + imageElements.length) % imageElements.length;

      // Bezpečné přepnutí obrázku
      lightbox.innerHTML = '';
      const img = document.createElement('img');
      img.src = `fotos/${imageElements[currentIndex]}`;
      img.alt = '';
      img.draggable = false;
      lightbox.appendChild(img);
    }

    lightbox.addEventListener('click', closeLightbox);

    document.addEventListener('keydown', (e) => {
      if (lightbox.style.display === 'flex') {
        if (e.key === 'Escape') closeLightbox();
        else if (e.key === 'ArrowRight') navigateLightbox(1);
        else if (e.key === 'ArrowLeft') navigateLightbox(-1);
        else if (e.key === 'Tab') {
          e.preventDefault(); // Klávesová past - zabrání přesunu focusu mimo lightbox
          lightbox.focus();
        }
      }
    });

    function copyAndOpen(event, element) {
      event.preventDefault();
      const urlToCopy = element.getAttribute('data-copy');
      navigator.clipboard.writeText(urlToCopy).then(() => {
        showCopyToast(`Zkopírováno: ${urlToCopy}`);
        window.open(element.href, '_blank');
      }).catch(err => {
        console.error('Chyba při kopírování:', err);
        window.open(element.href, '_blank');
      });
    }

    function showCopyToast(message) {
      const toast = document.getElementById('copy-toast');
      toast.textContent = message;
      toast.classList.add('show');
      setTimeout(() => {
        toast.classList.remove('show');
      }, 2500);
    }

    // Swipe gesta pro lightbox
    let touchStartX = 0;
    let touchEndX = 0;

    lightbox.addEventListener('touchstart', (e) => {
      touchStartX = e.changedTouches[0].screenX;
    });

    lightbox.addEventListener('touchend', (e) => {
      touchEndX = e.changedTouches[0].screenX;
      handleSwipe();
    });

    function handleSwipe() {
      const deltaX = touchEndX - touchStartX;
      if (Math.abs(deltaX) > 50) {
        if (deltaX < 0) navigateLightbox(1); // vpravo
        else navigateLightbox(-1); // vlevo
      }
    }
  </script>
</body>
</html>
